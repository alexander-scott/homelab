- name: Create a k8s namespace
  kubernetes.core.k8s:
    name: cert-manager
    api_version: v1
    kind: Namespace
    state: present

- name: Add cert-manager chart repo
  kubernetes.core.helm_repository:
    name: cert-manager
    repo_url: "https://charts.jetstack.io"
    binary_path: /snap/bin/helm

- name: Deploy cert-manager chart
  kubernetes.core.helm:
    binary_path: /snap/bin/helm
    name: cert-manager
    chart_ref: cert-manager/cert-manager
    release_namespace: cert-manager
    set_values:
      - value: crds.enabled=true
